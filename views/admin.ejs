<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetim Paneli - GRB Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --neon-pink: #ff00ff;
            --neon-blue: #00ffff;
            --neon-green: #39ff14;
            --neon-purple: #bc13fe;
            --bg-dark: #050505;
            --card-bg: rgba(20, 20, 20, 0.9);
        }

        body { 
            font-family: 'Rajdhani', sans-serif; 
            background-color: var(--bg-dark); 
            background-image: radial-gradient(circle at 50% 50%, #1a0b2e 0%, #000000 100%);
            color: #fff; 
            padding: 20px; 
            min-height: 100vh;
        }

        /* Işıltılı Animasyon */
        @keyframes neonPulse {
            0% { box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
            50% { box-shadow: 0 0 20px var(--neon-pink), 0 0 30px var(--neon-pink); }
            100% { box-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink); }
        }

        .container { max-width: 1100px; margin: 0 auto; }

        /* KART TASARIMI - Şeffaf ve Neon Kenarlı */
        .card { 
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: 15px; 
            border: 1px solid var(--neon-purple);
            box-shadow: 0 0 15px rgba(188, 19, 254, 0.3); 
            margin-bottom: 30px; 
            backdrop-filter: blur(5px);
        }

        /* HEADER KISMI */
        .header-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 2px solid var(--neon-blue); 
            padding-bottom: 15px; 
            margin-bottom: 20px; 
        }

        h1 { 
            font-family: 'Orbitron', sans-serif; 
            color: var(--neon-pink); 
            text-shadow: 0 0 10px var(--neon-pink);
            margin: 0; 
            letter-spacing: 2px;
        }
        
        h2 { 
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem; 
            color: var(--neon-blue); 
            margin-bottom: 15px; 
            border-bottom: 1px solid #333; 
            padding-bottom: 5px; 
            text-shadow: 0 0 8px var(--neon-blue);
        }

        p { color: #ccc; font-size: 1.1rem; }

        /* BUTONLAR - Parlak ve Degrade */
        .backup-actions { display: flex; gap: 15px; }
        
        .btn-backup { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            font-weight: bold; 
            color: #000; 
            text-decoration: none; 
            font-size: 14px; 
            display: inline-flex; 
            align-items: center; 
            text-transform: uppercase;
            transition: all 0.3s ease;
        }

        .btn-download { 
            background: var(--neon-blue); 
            box-shadow: 0 0 10px var(--neon-blue);
        }
        .btn-download:hover { 
            background: #fff; 
            box-shadow: 0 0 20px var(--neon-blue); 
        }

        .btn-upload { 
            background: var(--neon-pink); 
            box-shadow: 0 0 10px var(--neon-pink);
        }
        .btn-upload:hover { 
            background: #fff; 
            box-shadow: 0 0 20px var(--neon-pink); 
        }

        /* FORM ELEMANLARI */
        .form-row { display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap; }
        .form-group { display: flex; flex-direction: column; }
        
        .form-group label { 
            font-size: 0.9rem; 
            color: var(--neon-green); 
            margin-bottom: 5px; 
            font-weight: bold; 
            text-shadow: 0 0 5px rgba(57, 255, 20, 0.5);
        }

        input, select { 
            padding: 12px; 
            background: #111; 
            border: 1px solid #444; 
            color: #fff;
            border-radius: 5px; 
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
        }

        input:focus, select:focus { 
            outline: none; 
            border-color: var(--neon-blue); 
            box-shadow: 0 0 10px var(--neon-blue); 
        }

        /* Kaydet/Oluştur Butonları */
        button { 
            padding: 12px 25px; 
            background: transparent; 
            color: var(--neon-green); 
            border: 2px solid var(--neon-green); 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: bold; 
            text-transform: uppercase;
            font-family: 'Orbitron', sans-serif;
            transition: 0.3s;
        }
        
        button:hover { 
            background: var(--neon-green); 
            color: #000; 
            box-shadow: 0 0 20px var(--neon-green); 
        }

        button.update-btn { 
            background: linear-gradient(45deg, #1e4a9e, var(--neon-blue));
            border: none;
            color: white;
            padding: 8px 15px; 
            font-size: 0.9rem; 
        }
        button.update-btn:hover { box-shadow: 0 0 15px var(--neon-blue); }
        
        /* TABLO */
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; margin-top: 10px; }
        
        thead th { 
            text-align: left; 
            padding: 15px; 
            color: var(--neon-blue); 
            border-bottom: 2px solid var(--neon-blue); 
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        tbody tr { 
            background: rgba(255, 255, 255, 0.05); 
            transition: 0.3s; 
        }
        
        tbody tr:hover { 
            background: rgba(255, 0, 255, 0.1); 
            transform: scale(1.01);
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.2);
        }

        td { padding: 15px; border-bottom: 1px solid #333; color: #eee; }
        
        .link { 
            color: var(--neon-pink); 
            text-decoration: none; 
            font-weight: bold; 
            font-size: 1.1rem;
            text-shadow: 0 0 5px var(--neon-pink);
        }

        /* Placeholder rengi */
        ::placeholder { color: #555; }
    </style>
</head>
<body>

<div class="container">
    
    <div class="card" style="animation: neonPulse 3s infinite;">
        <div class="header-row">
            <h1>CENGİZ ATAY KARGO PANEL</h1>
            <div class="backup-actions">
                <a href="/admin/backup?secret=<%= secret %>" class="btn-backup btn-download">
                    İNDİR
                </a>

                <button onclick="document.getElementById('fileInput').click()" class="btn-backup btn-upload">
                    YÜKLE
                </button>
                <input type="file" id="fileInput" style="display: none;" accept=".json" onchange="yedekYukle(this)">
            </div>
        </div>
        <p>SİSTEMDEKİ TOPLAM KAYIT: <strong style="color: var(--neon-green); font-size: 1.5rem;"><%= items.length %></strong></p>
    </div>

    <div class="card">
        <h2>KARGO EKLE</h2>
        <form action="/admin/create" method="POST">
            <input type="hidden" name="secret" value="<%= secret %>">
            <div class="form-row">
                <div class="form-group" style="flex: 1;">
                    <label>TAKİP NO (ID)</label>
                    <input type="text" name="id" placeholder="Boşsa otomatik">
                </div>
                <div class="form-group" style="flex: 2;">
                    <label>ALICI AD SOYAD</label>
                    <input type="text" name="full_name" placeholder="Ad Soyad" required>
                </div>
                <div class="form-group" style="flex: 2;">
                    <label>ADRES / ŞEHİR</label>
                    <input type="text" name="address" placeholder="Ankara, Çankaya" required>
                </div>
                <div class="form-group">
                    <label>TAHMİNİ TARİH</label>
                    <input type="text" name="eta" value="<%= new Date().toISOString().split('T')[0] %>">
                </div>
                <div class="form-group">
                    <button type="submit">OLUŞTUR</button>
                </div>
            </div>
        </form>
    </div>

    <div class="card">
        <table>
            <thead>
                <tr>
                    <th>Kargo Bilgisi</th>
                    <th>Durum</th>
                    <th>Tarih</th>
                    <th>İşlem</th>
                </tr>
            </thead>
            <tbody>
                <% items.forEach(function(item) { %>
                    <tr>
                        <form action="/admin/update" method="POST">
                            <input type="hidden" name="secret" value="<%= secret %>">
                            <input type="hidden" name="id" value="<%= item.id %>">
                            <td>
                                <a href="/t/<%= item.id %>" target="_blank" class="link">#<%= item.id %></a><br>
                                <strong style="color: #fff; font-size: 1.1em;"><%= item.full_name %></strong><br>
                                <small style="color: #888;"><%= item.address %></small>
                            </td>
                            <td>
                                <select name="status">
                                    <option value="Hazırlandı" <%= item.status === 'Hazırlandı' ? 'selected' : '' %>>Hazırlandı</option>
                                    <option value="Yola çıktı" <%= item.status === 'Yola çıktı' ? 'selected' : '' %>>Yola çıktı</option>
                                    <option value="Dağıtımda" <%= item.status === 'Dağıtımda' ? 'selected' : '' %>>Dağıtımda</option>
                                    <option value="Teslim edildi" <%= item.status === 'Teslim edildi' ? 'selected' : '' %>>Teslim edildi</option>
                                </select>
                            </td>
                            <td><input type="text" name="eta" value="<%= item.eta %>" style="width: 120px; text-align: center;"></td>
                            <td><button type="submit" class="update-btn">KAYDET</button></td>
                        </form>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
</div>

<script>
    // YEDEK YÜKLEME JS KODU (AYNEN KORUNDU)
    function yedekYukle(input) {
        if (!input.files || !input.files[0]) return;
        
        const file = input.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
            try {
                const jsonData = JSON.parse(e.target.result);
                
                if (!confirm(jsonData.length + " adet kargo kaydı yüklenecek. Onaylıyor musun?")) {
                    input.value = ""; // İptal edilirse temizle
                    return;
                }

                // Sunucuya gönder
                fetch('/admin/restore', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        secret: "<%= secret %>",
                        data: jsonData
                    })
                })
                .then(res => res.json())
                .then(response => {
                    if (response.success) {
                        alert("✅ Başarılı! " + response.count + " kayıt yüklendi.");
                        location.reload();
                    } else {
                        alert("❌ Hata: " + response.msg);
                    }
                })
                .catch(err => alert("Bağlantı hatası: " + err));

            } catch (err) {
                alert("❌ Dosya okunamadı! Geçersiz JSON formatı.");
            }
        };

        reader.readAsText(file);
    }
</script>

</body>
</html>

